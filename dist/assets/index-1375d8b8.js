(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerpolicy&&(h.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?h.credentials="include":s.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(s){if(s.ep)return;s.ep=!0;const h=r(s);fetch(s.href,h)}})();const vt="modulepreload",gt=function(e){return"/"+e},Ge={},bt=function(i,r,o){if(!r||r.length===0)return i();const s=document.getElementsByTagName("link");return Promise.all(r.map(h=>{if(h=gt(h),h in Ge)return;Ge[h]=!0;const d=h.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(!!o)for(let _=s.length-1;_>=0;_--){const a=s[_];if(a.href===h&&(!d||a.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${m}`))return;const C=document.createElement("link");if(C.rel=d?"stylesheet":vt,d||(C.as="script",C.crossOrigin=""),C.href=h,document.head.appendChild(C),d)return new Promise((_,a)=>{C.addEventListener("load",_),C.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${h}`)))})})).then(()=>i())},rt=(e,i)=>{i=Xe(i),e!==void 0?(e=Xe(e),e.appendChild(i)):document.body.appendChild(i)},Xe=e=>{if(typeof e=="string"){const i=document.querySelector(e);if(!i)throw new Error(`could not find the element with the selector: ${e}`);return i}return e},at=e=>{if(typeof e=="string"){const i=document.querySelector(e);if(!i)throw new Error(`could not find the element with the selector: ${e}`);return i}return e};var st=({parent:e,mode:i="2d",width:r,height:o,pixelRatio:s=1,scaleContext:h=!0,attributes:d})=>{if(s<=0)throw new Error("pixelRatio must be great than 0");const m=document.createElement("canvas");return rt(e,m),ie({canvas:m,mode:i,width:r,height:o,pixelRatio:s,scaleContext:h,attributes:d})},ie=({canvas:e,mode:i,width:r,height:o,pixelRatio:s=1,scaleContext:h=!0,attributes:d})=>{e.width=r*s,e.height=o*s,e.style.width=`${r}px`,e.style.height=`${o}px`;let m,w;if(i==="2d"){if(m=e.getContext("2d",d),!m)throw new Error("2d context cannot be created");h&&m.scale(s,s)}else if(i==="webgl"){if(m=e.getContext("webgl",d),w=m,!m)throw new Error("webgl context cannot be created");h?w.viewport(0,0,r*s,o*s):w.viewport(0,0,r,o)}else throw new Error(`${i} is not supported`);if(m)return{canvas:e,context:m,gl:w,width:r,height:o};throw new Error(`${i} context could not be created`)},ii=({parent:e,canvas:i,width:r,height:o,pixelRatio:s=1})=>{if(s<=0)throw new Error("pixelRatio must be great than 0");return rt(e,i),i.width=r*s,i.height=o*s,i.style.width=`${r}px`,i.style.height=`${o}px`,{canvas:i,width:r,height:o,pixelRatio:s}};function kt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Te={},_t={get exports(){return Te},set exports(e){Te=e}};(function(e){var i=(()=>{var r=Object.defineProperty,o=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,h=Object.prototype.hasOwnProperty,d=Math.pow,m=(t,n)=>{for(var l in n)r(t,l,{get:n[l],enumerable:!0})},w=(t,n,l,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of s(n))!h.call(t,f)&&f!==l&&r(t,f,{get:()=>n[f],enumerable:!(c=o(n,f))||c.enumerable});return t},C=t=>w(r({},"__esModule",{value:!0}),t),_=(t,n,l)=>{if(!n.has(t))throw TypeError("Cannot "+l)},a=(t,n,l)=>(_(t,n,"read from private field"),l?l.call(t):n.get(t)),u=(t,n,l)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,l)},b=(t,n,l,c)=>(_(t,n,"write to private field"),c?c.call(t,l):n.set(t,l),l),y=(t,n,l)=>(_(t,n,"access private method"),l),re={};m(re,{default:()=>pt});var L=class{constructor(t){this.value=t}},E=class{constructor(t){this.value=t}},v=class{constructor(){this.pos=0,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}writeFloat32(t){this.helperView.setFloat32(0,t,!1),this.write(this.helper.subarray(0,4))}writeFloat64(t){this.helperView.setFloat64(0,t,!1),this.write(this.helper)}writeUnsignedInt(t,n=k(t)){let l=0;switch(n){case 6:this.helperView.setUint8(l++,t/d(2,40)|0);case 5:this.helperView.setUint8(l++,t/d(2,32)|0);case 4:this.helperView.setUint8(l++,t>>24);case 3:this.helperView.setUint8(l++,t>>16);case 2:this.helperView.setUint8(l++,t>>8);case 1:this.helperView.setUint8(l++,t);break;default:throw new Error("Bad UINT size "+n)}this.write(this.helper.subarray(0,l))}writeEBMLVarInt(t,n=ht(t)){let l=0;switch(n){case 1:this.helperView.setUint8(l++,1<<7|t);break;case 2:this.helperView.setUint8(l++,1<<6|t>>8),this.helperView.setUint8(l++,t);break;case 3:this.helperView.setUint8(l++,1<<5|t>>16),this.helperView.setUint8(l++,t>>8),this.helperView.setUint8(l++,t);break;case 4:this.helperView.setUint8(l++,1<<4|t>>24),this.helperView.setUint8(l++,t>>16),this.helperView.setUint8(l++,t>>8),this.helperView.setUint8(l++,t);break;case 5:this.helperView.setUint8(l++,1<<3|t/d(2,32)&7),this.helperView.setUint8(l++,t>>24),this.helperView.setUint8(l++,t>>16),this.helperView.setUint8(l++,t>>8),this.helperView.setUint8(l++,t);break;case 6:this.helperView.setUint8(l++,1<<2|t/d(2,40)&3),this.helperView.setUint8(l++,t/d(2,32)|0),this.helperView.setUint8(l++,t>>24),this.helperView.setUint8(l++,t>>16),this.helperView.setUint8(l++,t>>8),this.helperView.setUint8(l++,t);break;default:throw new Error("Bad EBML VINT size "+n)}this.write(this.helper.subarray(0,l))}writeString(t){this.write(new Uint8Array(t.split("").map(n=>n.charCodeAt(0))))}writeEBML(t){var n,l;if(t instanceof Uint8Array)this.write(t);else if(Array.isArray(t))for(let c of t)this.writeEBML(c);else if(this.offsets.set(t,this.pos),this.writeUnsignedInt(t.id),Array.isArray(t.data)){let c=this.pos,f=(n=t.size)!=null?n:4;this.seek(this.pos+f);let g=this.pos;this.dataOffsets.set(t,g),this.writeEBML(t.data);let x=this.pos-g,F=this.pos;this.seek(c),this.writeEBMLVarInt(x,f),this.seek(F)}else if(typeof t.data=="number"){let c=(l=t.size)!=null?l:k(t.data);this.writeEBMLVarInt(c),this.writeUnsignedInt(t.data,c)}else typeof t.data=="string"?(this.writeEBMLVarInt(t.data.length),this.writeString(t.data)):t.data instanceof Uint8Array?(this.writeEBMLVarInt(t.data.byteLength,t.size),this.write(t.data)):t.data instanceof L?(this.writeEBMLVarInt(4),this.writeFloat32(t.data.value)):t.data instanceof E&&(this.writeEBMLVarInt(8),this.writeFloat64(t.data.value))}},k=t=>t<1<<8?1:t<1<<16?2:t<1<<24?3:t<d(2,32)?4:t<d(2,40)?5:6,ht=t=>{if(t<(1<<7)-1)return 1;if(t<(1<<14)-1)return 2;if(t<(1<<21)-1)return 3;if(t<(1<<28)-1)return 4;if(t<d(2,35)-1)return 5;if(t<d(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+t)},Pe=class extends v{constructor(){super(),this.buffer=new ArrayBuffer(d(2,16)),this.bytes=new Uint8Array(this.buffer)}ensureSize(t){let n=this.buffer.byteLength;for(;n<t;)n*=2;if(n===this.buffer.byteLength)return;let l=new ArrayBuffer(n),c=new Uint8Array(l);c.set(this.bytes,0),this.buffer=l,this.bytes=c}write(t){this.ensureSize(this.pos+t.byteLength),this.bytes.set(t,this.pos),this.pos+=t.byteLength}seek(t){this.pos=t}finalize(){return this.ensureSize(this.pos),this.buffer.slice(0,this.pos)}},A=d(2,24),dt=2,Be=class extends v{constructor(t){super(),this.chunks=[],this.stream=t}write(t){this.writeDataIntoChunks(t,this.pos),this.flushChunks(),this.pos+=t.byteLength}writeDataIntoChunks(t,n){let l=this.chunks.findIndex(F=>F.start<=n&&n<F.start+A);l===-1&&(l=this.createChunk(n));let c=this.chunks[l],f=n-c.start,g=t.subarray(0,Math.min(A-f,t.byteLength));c.data.set(g,f);let x={start:f,end:f+g.byteLength};if(ft(c,x),c.written[0].start===0&&c.written[0].end===A&&(c.shouldFlush=!0),this.chunks.length>dt){for(let F=0;F<this.chunks.length-1;F++)this.chunks[F].shouldFlush=!0;this.flushChunks()}g.byteLength<t.byteLength&&this.writeDataIntoChunks(t.subarray(g.byteLength),n+g.byteLength)}createChunk(t){let l={start:Math.floor(t/A)*A,data:new Uint8Array(A),written:[],shouldFlush:!1};return this.chunks.push(l),this.chunks.sort((c,f)=>c.start-f.start),this.chunks.indexOf(l)}flushChunks(t=!1){for(let n=0;n<this.chunks.length;n++){let l=this.chunks[n];if(!(!l.shouldFlush&&!t)){for(let c of l.written)this.stream.write({type:"write",data:l.data.subarray(c.start,c.end),position:l.start+c.start});this.chunks.splice(n--,1)}}}seek(t){this.pos=t}finalize(){this.flushChunks(!0)}},ft=(t,n)=>{let l=0,c=t.written.length-1,f=-1;for(;l<=c;){let g=Math.floor(l+(c-l+1)/2);t.written[g].start<=n.start?(l=g+1,f=g):c=g-1}for(t.written.splice(f+1,0,n),(f===-1||t.written[f].end<n.start)&&f++;f<t.written.length-1&&t.written[f].end>=t.written[f+1].start;)t.written[f].end=Math.max(t.written[f].end,t.written[f+1].end),t.written.splice(f+1,1)},q=1,ce=2,ct=1,ut=2,ue=d(2,15),me=d(2,12),ze="https://github.com/Vanilagy/webm-muxer",Re=6,Ae=5,p,M,Y,Z,S,G,$,D,X,Q,N,I,O,J,W,V,ae,se,ee,ne,pe,$e,we,De,ye,Ne,ve,Oe,ge,He,be,Ke,ke,je,z,H,_e,qe,Me,Ye,oe,Ce,P,R,le,Ee,Fe,Ze,he,xe,de,Le,mt=class{constructor(t){u(this,pe),u(this,we),u(this,ye),u(this,ve),u(this,ge),u(this,be),u(this,ke),u(this,z),u(this,_e),u(this,Me),u(this,oe),u(this,P),u(this,le),u(this,Fe),u(this,he),u(this,de),u(this,p,void 0),u(this,M,void 0),u(this,Y,void 0),u(this,Z,void 0),u(this,S,void 0),u(this,G,void 0),u(this,$,void 0),u(this,D,void 0),u(this,X,void 0),u(this,Q,void 0),u(this,N,void 0),u(this,I,void 0),u(this,O,void 0),u(this,J,0),u(this,W,[]),u(this,V,[]),u(this,ae,0),u(this,se,0),u(this,ee,void 0),u(this,ne,!1),b(this,M,t),t.target==="buffer"?b(this,p,new Pe):b(this,p,new Be(t.target)),y(this,pe,$e).call(this)}addVideoChunk(t,n,l){let c=new Uint8Array(t.byteLength);t.copyTo(c),this.addVideoChunkRaw(c,t.type,l??t.timestamp,n)}addVideoChunkRaw(t,n,l,c){if(y(this,de,Le).call(this),!a(this,M).video)throw new Error("No video track declared.");c&&y(this,_e,qe).call(this,c);let f=y(this,oe,Ce).call(this,t,n,l,q);for(a(this,M).video.codec==="V_VP9"&&y(this,Me,Ye).call(this,f),b(this,ae,f.timestamp);a(this,V).length>0&&a(this,V)[0].timestamp<=f.timestamp;){let g=a(this,V).shift();y(this,P,R).call(this,g)}!a(this,M).audio||f.timestamp<=a(this,se)?y(this,P,R).call(this,f):a(this,W).push(f)}addAudioChunk(t,n,l){let c=new Uint8Array(t.byteLength);t.copyTo(c),this.addAudioChunkRaw(c,t.type,l??t.timestamp,n)}addAudioChunkRaw(t,n,l,c){if(y(this,de,Le).call(this),!a(this,M).audio)throw new Error("No audio track declared.");let f=y(this,oe,Ce).call(this,t,n,l,ce);for(b(this,se,f.timestamp);a(this,W).length>0&&a(this,W)[0].timestamp<=f.timestamp;){let g=a(this,W).shift();y(this,P,R).call(this,g)}!a(this,M).video||f.timestamp<=a(this,ae)?y(this,P,R).call(this,f):a(this,V).push(f),c!=null&&c.decoderConfig&&y(this,le,Ee).call(this,a(this,Q),c.decoderConfig.description)}finalize(){for(;a(this,W).length>0;)y(this,P,R).call(this,a(this,W).shift());for(;a(this,V).length>0;)y(this,P,R).call(this,a(this,V).shift());y(this,he,xe).call(this),a(this,p).writeEBML(a(this,N));let t=a(this,p).pos,n=a(this,p).pos-a(this,z,H);return a(this,p).seek(a(this,p).offsets.get(a(this,Y))+4),a(this,p).writeEBMLVarInt(n,Re),a(this,$).data=new E(a(this,J)),a(this,p).seek(a(this,p).offsets.get(a(this,$))),a(this,p).writeEBML(a(this,$)),a(this,S).data[0].data[1].data=a(this,p).offsets.get(a(this,N))-a(this,z,H),a(this,S).data[1].data[1].data=a(this,p).offsets.get(a(this,Z))-a(this,z,H),a(this,S).data[2].data[1].data=a(this,p).offsets.get(a(this,G))-a(this,z,H),a(this,p).seek(a(this,p).offsets.get(a(this,S))),a(this,p).writeEBML(a(this,S)),a(this,p).seek(t),b(this,ne,!0),a(this,p)instanceof Pe?a(this,p).finalize():(a(this,p)instanceof Be&&a(this,p).finalize(),null)}};p=new WeakMap,M=new WeakMap,Y=new WeakMap,Z=new WeakMap,S=new WeakMap,G=new WeakMap,$=new WeakMap,D=new WeakMap,X=new WeakMap,Q=new WeakMap,N=new WeakMap,I=new WeakMap,O=new WeakMap,J=new WeakMap,W=new WeakMap,V=new WeakMap,ae=new WeakMap,se=new WeakMap,ee=new WeakMap,ne=new WeakMap,pe=new WeakSet,$e=function(){y(this,we,De).call(this),y(this,ye,Ne).call(this),y(this,ve,Oe).call(this),y(this,ge,He).call(this),y(this,be,Ke).call(this),y(this,ke,je).call(this)},we=new WeakSet,De=function(){let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]};a(this,p).writeEBML(t)},ye=new WeakSet,Ne=function(){const t=new Uint8Array([28,83,187,107]),n=new Uint8Array([21,73,169,102]),l=new Uint8Array([22,84,174,107]);b(this,S,{id:290298740,data:[{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:n},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:l},{id:21420,size:5,data:0}]}]})},ve=new WeakSet,Oe=function(){let t={id:17545,data:new E(0)};b(this,$,t),b(this,Z,{id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:ze},{id:22337,data:ze},t]})},ge=new WeakSet,He=function(){let t={id:374648427,data:[]};if(b(this,G,t),a(this,M).video){b(this,X,{id:236,size:4,data:new Uint8Array(me)});let n={id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]};b(this,D,n),t.data.push({id:174,data:[{id:215,data:q},{id:29637,data:q},{id:131,data:ct},{id:134,data:a(this,M).video.codec},a(this,X),a(this,M).video.frameRate?{id:2352003,data:1e9/a(this,M).video.frameRate}:null,{id:224,data:[{id:176,data:a(this,M).video.width},{id:186,data:a(this,M).video.height},n]}].filter(Boolean)})}a(this,M).audio&&(b(this,Q,{id:236,size:4,data:new Uint8Array(me)}),t.data.push({id:174,data:[{id:215,data:ce},{id:29637,data:ce},{id:131,data:ut},{id:134,data:a(this,M).audio.codec},a(this,Q),{id:225,data:[{id:181,data:new L(a(this,M).audio.sampleRate)},{id:159,data:a(this,M).audio.numberOfChannels},a(this,M).audio.bitDepth?{id:25188,data:a(this,M).audio.bitDepth}:null].filter(Boolean)}]}))},be=new WeakSet,Ke=function(){let t={id:408125543,size:Re,data:[a(this,S),a(this,Z),a(this,G)]};b(this,Y,t),a(this,p).writeEBML(t)},ke=new WeakSet,je=function(){b(this,N,{id:475249515,data:[]})},z=new WeakSet,H=function(){return a(this,p).dataOffsets.get(a(this,Y))},_e=new WeakSet,qe=function(t){if(t.decoderConfig){if(t.decoderConfig.colorSpace){let n=t.decoderConfig.colorSpace;b(this,ee,n),a(this,D).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[n.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[n.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[n.primaries]},{id:21945,data:[1,2][Number(n.fullRange)]}];let l=a(this,p).pos;a(this,p).seek(a(this,p).offsets.get(a(this,D))),a(this,p).writeEBML(a(this,D)),a(this,p).seek(l)}t.decoderConfig.description&&y(this,le,Ee).call(this,a(this,X),t.decoderConfig.description)}},Me=new WeakSet,Ye=function(t){if(t.type!=="key"||!a(this,ee))return;let n=0;if(K(t.data,0,2)!==2)return;n+=2;let l=(K(t.data,n+1,n+2)<<1)+K(t.data,n+0,n+1);n+=2,l===3&&n++;let c=K(t.data,n+0,n+1);if(n++,c)return;let f=K(t.data,n+0,n+1);if(n++,f!==0)return;n+=2;let g=K(t.data,n+0,n+24);if(n+=24,g!==4817730)return;l>=2&&n++;let x={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[a(this,ee).matrix];wt(t.data,n+0,n+3,x)},oe=new WeakSet,Ce=function(t,n,l,c){return{data:t,type:n,timestamp:l,trackNumber:c}},P=new WeakSet,R=function(t){let n=Math.floor(t.timestamp/1e3);if(t.type!=="key"&&n-a(this,O)>=ue)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${ue} milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every ${ue} milliseconds.`);let c=(t.trackNumber===q||!a(this,M).video)&&t.type==="key"&&n-a(this,O)>=1e3;(!a(this,I)||c)&&y(this,Fe,Ze).call(this,n);let f=new Uint8Array(4),g=new DataView(f.buffer);g.setUint8(0,128|t.trackNumber),g.setUint16(1,n-a(this,O),!1),g.setUint8(3,Number(t.type==="key")<<7);let x={id:163,data:[f,t.data]};a(this,p).writeEBML(x),b(this,J,Math.max(a(this,J),n))},le=new WeakSet,Ee=function(t,n){let l=a(this,p).pos;a(this,p).seek(a(this,p).offsets.get(t)),t=[{id:25506,size:4,data:new Uint8Array(n)},{id:236,size:4,data:new Uint8Array(me-2-4-n.byteLength)}],a(this,p).writeEBML(t),a(this,p).seek(l)},Fe=new WeakSet,Ze=function(t){a(this,I)&&y(this,he,xe).call(this),b(this,I,{id:524531317,size:Ae,data:[{id:231,data:t}]}),a(this,p).writeEBML(a(this,I)),b(this,O,t);let n=a(this,p).offsets.get(a(this,I))-a(this,z,H);a(this,N).data.push({id:187,data:[{id:179,data:t},{id:183,data:[{id:247,data:q},{id:241,data:n}]}]})},he=new WeakSet,xe=function(){let t=a(this,p).pos-a(this,p).dataOffsets.get(a(this,I)),n=a(this,p).pos;a(this,p).seek(a(this,p).offsets.get(a(this,I))+4),a(this,p).writeEBMLVarInt(t,Ae),a(this,p).seek(n)},de=new WeakSet,Le=function(){if(a(this,ne))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var pt=mt,K=(t,n,l)=>{let c=0;for(let f=n;f<l;f++){let g=Math.floor(f/8),x=t[g],F=7-(f&7),yt=(x&1<<F)>>F;c<<=1,c|=yt}return c},wt=(t,n,l,c)=>{for(let f=n;f<l;f++){let g=Math.floor(f/8),x=t[g],F=7-(f&7);x&=~(1<<F),x|=(c&1<<l-f-1)>>l-f-1<<F,t[g]=x}};return C(re)})();i=i.default,e.exports=i})(_t);const Mt=kt(Te);var Qe=({settings:e,props:i})=>{const{duration:r}=e;i.playhead=r!==1/0?i.time/r:0},Ct=({settings:e,states:i,props:r})=>{let{duration:o,playFps:s,exportFps:h,totalFrames:d}=e;const m=i.savingFrames?h:s;i.savingFrames&&(d=Math.floor(h*o/1e3)),o!==1/0?m!==null?r.frame=Math.floor(r.playhead*d):r.frame+=1:m!==null?r.frame=Math.floor(r.time*m/1e3):r.frame+=1},Je=({states:e,props:i})=>{e.lastTimestamp=e.frameInterval?e.timestamp-i.deltaTime%e.frameInterval:e.timestamp},Se=({settings:e,states:i,props:r})=>{const{playFps:o,exportFps:s}=e,h=i.savingFrames?s:o;i.startTime=i.timestamp,r.time=0,r.playhead=0,r.frame=o?0:-1,i.lastTimestamp=i.startTime-(h?1e3/h:0),i.timeResetted=!1},Et=({main:e})=>{const i={title:"Sketch",background:"#333",parent:"body",canvas:null,dimensions:[window.innerWidth,window.innerHeight],pixelRatio:1,centered:!0,scaleContext:!0,pixelated:!1,animate:!0,playFps:null,exportFps:60,duration:1/0,totalFrames:1/0,exportTotalFrames:1/0,filename:"",prefix:"",suffix:"",frameFormat:"png",framesFormat:"webm",hotkeys:!0,mode:"2d"},r=Object.assign({},i,e);for(const[o,s]of Object.entries(r))s===void 0&&(r[o]=i[o]);if(Object.values(r).some(o=>o===void 0))throw new Error("settings object cannot have undefined values");return document.title=r.title,document.body.style.background=r.background,r.playFps!==null&&(r.playFps=Math.max(Math.floor(r.playFps),1)),r.exportFps=Math.max(Math.floor(r.exportFps),1),r.playFps!==null&&r.duration!==1/0&&(r.totalFrames=Math.floor(r.duration*r.playFps/1e3)),r.exportFps!==null&&r.duration!==1/0&&(r.exportTotalFrames=Math.floor(r.exportFps*r.duration/1e3)),r},et=e=>{let i,r,[o,s]=e.dimensions;const h=Math.max(e.pixelRatio,1),d="2d";if(e.canvas===void 0||e.canvas===null)({canvas:i,context:r,width:o,height:s}=st({parent:e.parent,mode:d,width:o,height:s,pixelRatio:h,scaleContext:e.scaleContext,attributes:e.attributes}));else{if(e.canvas.nodeName.toLowerCase()!=="canvas")throw new Error("provided canvas must be an HTMLCanvasElement");i=e.canvas,e.parent&&at(e.parent).appendChild(i),{context:r,width:o,height:s}=ie({canvas:i,mode:d,width:e.dimensions?e.dimensions[0]:i.width,height:e.dimensions?e.dimensions[1]:i.height,pixelRatio:h,scaleContext:e.scaleContext,attributes:e.attributes})}if(e.centered===!0){const m=i.parentElement;m.style.width="100vw",m.style.height="100vh",m.style.display="flex",m.style.justifyContent="center",m.style.alignItems="center",e.scaleContext}else i.style.width=100+"%",i.style.height=100+"%",i.style.maxWidth=`${e.dimensions[0]}px`,i.style.maxHeight=`${e.dimensions[1]}px`;return{canvas:i,context:r,width:o,height:s,pixelRatio:h}},Ft=e=>{let i,r,o,[s,h]=e.dimensions;const d=Math.max(e.pixelRatio,1),m="webgl";if(e.canvas===void 0||e.canvas===null)({canvas:i,context:r,gl:o,width:s,height:h}=st({parent:e.parent,mode:m,width:s,height:h,pixelRatio:d,scaleContext:e.scaleContext,attributes:e.attributes}));else{if(e.canvas.nodeName.toLowerCase()!=="canvas")throw new Error("provided canvas must be an HTMLCanvasElement");i=e.canvas,e.parent&&at(e.parent).appendChild(i),{context:r,gl:o,width:s,height:h}=ie({canvas:i,mode:m,width:e.dimensions?e.dimensions[0]:i.width,height:e.dimensions?e.dimensions[1]:i.height,pixelRatio:d,scaleContext:e.scaleContext,attributes:e.attributes})}if(e.centered===!0){const w=i.parentElement;w.style.width="100vw",w.style.height="100vh",w.style.display="flex",w.style.justifyContent="center",w.style.alignItems="center",e.scaleContext}else i.style.width=100+"%",i.style.height=100+"%",i.style.maxWidth=`${e.dimensions[0]}px`,i.style.maxHeight=`${e.dimensions[1]}px`;return{canvas:i,context:r,gl:o,width:s,height:h,pixelRatio:d}},xt=async e=>e.mode==="2d"?et(e):e.mode==="webgl"?Ft(e):e.mode==="ogl"?(await bt(()=>import("./ogl-SXYU76IS-877e9c21.js"),[])).createOglCanvas(e):et(e),nt=({filename:e,prefix:i="",suffix:r=""})=>e===void 0||e===""?`${i}${Lt(new Date)}${r}`:e,Lt=e=>{const i=e.getTimezoneOffset();e.setMinutes(e.getMinutes()-i);const r=e.toISOString(),[o,s,h,d,m,w,C]=r.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);return`${s}.${h}.${d}-${m}.${w}.${C}`},St=({canvas:e,states:i,settings:r})=>{let{filename:o,prefix:s,suffix:h,frameFormat:d}=r;d==="jpg"&&(d="jpeg");const m=e.toDataURL(`image/${d}`),w=document.createElement("a");w.download=`${nt({filename:o,prefix:s,suffix:h})}.${d}`,w.href=m,w.click(),i.savingFrame=!1,i.playMode="play"},It=async({settings:e,states:i})=>{const{canvas:r,context:o,width:s,height:h,pixelRatio:d,gl:m,oglContext:w,oglRenderer:C}=await xt(e),{exportFrame:_,update:a,togglePlay:u}=Ut({canvas:r,settings:e,states:i}),b={canvas:r,width:s,height:h,pixelRatio:d,playhead:0,frame:0,time:0,deltaTime:0,duration:e.duration,totalFrames:e.totalFrames,exportFrame:_,togglePlay:u,update:a};let y;return e.mode==="2d"?y={...b,context:o}:e.mode==="ogl"?y={...b,oglContext:w,oglRenderer:C}:y={...b,gl:m},y},Ut=({canvas:e,settings:i,states:r})=>({exportFrame:Tt({canvas:e,settings:i,states:r}),update:Vt({canvas:e,prevSettings:i,resizeCanvas:ie}),togglePlay:Wt({states:r})}),Tt=({canvas:e,settings:i,states:r})=>()=>{r.savingFrame=!0,r.playMode="record",St({canvas:e,settings:i,states:r})},Wt=({states:e})=>()=>{e.paused=!e.paused,e.paused&&(e.pausedStartTime=e.timestamp)},Vt=({canvas:e,prevSettings:i,resizeCanvas:r})=>o=>{console.log("update() prop is not yet implemented.")},Pt=(e,i,r,o,s,h)=>{const d=()=>{if(r.dimensions===void 0&&r.canvas===void 0&&((o.mode==="2d"||o.mode==="webgl")&&({width:i.width,height:i.height}=ie({canvas:e,mode:o.mode,width:window.innerWidth,height:window.innerHeight,pixelRatio:Math.max(o.pixelRatio,1),scaleContext:o.scaleContext})),h(i)),s(i),r.dimensions!==void 0&&o.centered){const _=e.parentElement,a=_.clientWidth,u=_.clientHeight,b=Math.min(1,Math.min((a-50*2)/i.width,(u-50*2)/i.height));e.style.transform=`scale(${b})`}};return{add:()=>{window.addEventListener("resize",d)},remove:()=>{window.removeEventListener("resize",d)},handleResize:d}},Bt=(e,i)=>{const r=h=>{h.key===" "?(h.preventDefault(),e.togglePlay()):(h.metaKey||h.ctrlKey)&&!h.shiftKey&&h.key==="s"?(h.preventDefault(),e.exportFrame()):(h.metaKey||h.ctrlKey)&&h.shiftKey&&h.key==="s"?(h.preventDefault(),i.savingFrames?i.captureDone=!0:i.savingFrames=!0):h.key==="t"&&(i.timeResetted=!0)};return{add:()=>{window.addEventListener("keydown",r)},remove:()=>{window.removeEventListener("keydown",r)}}},zt=({settings:e})=>({paused:!1,playMode:"play",savingFrame:!1,savingFrames:!1,captureReady:!1,captureDone:!1,startTime:0,lastStartTime:0,pausedStartTime:0,pausedDuration:0,timestamp:0,lastTimestamp:0,frameInterval:e.playFps!==null?1e3/e.playFps:null,timeResetted:!1}),B=null,U=null,We=null,Rt=async({canvas:e,settings:i,states:r,props:o})=>{const{framesFormat:s}=i;if(s!=="webm")throw new Error("currently, only webm video format is supported");r.captureDone||Dt({canvas:e,settings:i,states:r,props:o}),r.captureDone&&$t({canvas:e,settings:i})},At=({canvas:e,settings:i})=>{const{framesFormat:r}=i;if(r!=="webm")throw new Error("currently, only webm video format is supported");B=new Mt({target:"buffer",video:{codec:"V_VP9",width:e.width,height:e.height,frameRate:i.exportFps}}),U=new VideoEncoder({output:(o,s)=>B==null?void 0:B.addVideoChunk(o,s),error:o=>console.error(`WebMMuxer error: ${o}`)}),U.configure({codec:"vp09.00.10.08",width:e.width,height:e.height,bitrate:1e7}),We=-1/0,e.style.outline="3px solid red",e.style.outlineOffset="-3px",console.log(`recording (${r}) started`)},$t=async({canvas:e,settings:i})=>{const{framesFormat:r}=i;await(U==null?void 0:U.flush());const o=B==null?void 0:B.finalize();Nt(new Blob([o]),i),B=null,U=null,e.style.outline="none",e.style.outlineOffset="0 ",console.log(`recording (${r}) complete`)},Dt=({canvas:e,settings:i,states:r,props:o})=>{const s=new VideoFrame(e,{timestamp:o.time*1e3}),h=o.time-We>=1e4;h&&(We=o.time),U==null||U.encode(s,{keyFrame:h}),s.close();const d=Math.floor(i.exportFps*i.duration/1e3);console.log(`%crecording frame... %c${o.frame+1} of ${d}`,"color:black","color:#9aa")},Nt=(e,i)=>{const{filename:r,prefix:o,suffix:s,framesFormat:h}=i,d=window.URL.createObjectURL(e),m=document.createElement("a");m.href=d,m.download=`${nt({filename:r,prefix:o,suffix:s})}.${h}`,m.click(),window.URL.revokeObjectURL(d)},Ot=async(e,i)=>{const r=Et({main:i}),o=zt({settings:r}),s=await It({settings:r,states:o}),{canvas:h}=s,d=e(s);let m=()=>{},w=()=>{};typeof d=="function"?m=d:(m=d.render||m,w=d.resize||w);const{add:C,handleResize:_}=Pt(h,s,i,r,m,w),{add:a}=Bt(s,o);_();const u=L=>{o.timestamp=L-o.pausedDuration,o.savingFrames?re({canvas:h,settings:r,states:o,props:s}):b({timestamp:L,settings:r,states:o,props:s})};r.animate&&window.requestAnimationFrame(u),r.hotkeys&&(C(),a());const b=({timestamp:L,settings:E,states:v,props:k})=>{if(v.paused){v.pausedDuration=L-v.pausedStartTime,window.requestAnimationFrame(u);return}if(v.timeResetted&&Se({settings:E,states:v,props:k}),k.time=v.timestamp-v.startTime,k.time>=k.duration&&Se({settings:E,states:v,props:k}),k.deltaTime=v.timestamp-v.lastTimestamp,v.frameInterval!==null&&k.deltaTime<v.frameInterval){window.requestAnimationFrame(u);return}Qe({settings:E,props:k}),Ct({settings:E,states:v,props:k}),Je({states:v,props:k}),m(k),window.requestAnimationFrame(u)};let y=0;const re=({canvas:L,settings:E,states:v,props:k})=>{v.captureReady||(Se({settings:E,states:v,props:k}),At({canvas:L,settings:E}),v.captureReady=!0),k.deltaTime=1e3/E.exportFps,k.time=y*k.deltaTime,Qe({settings:E,props:k}),k.frame=y,Je({states:v,props:k}),m(k),window.requestAnimationFrame(u),y+=1,k.frame>=E.exportTotalFrames&&(v.captureDone=!0),Rt({canvas:L,settings:E,states:v,props:k}),v.captureDone&&(v.captureReady=!1,v.captureDone=!1,v.savingFrames=!1,v.timeResetted=!0,y=0)}},Ht=Ot;const tt=(e,i,r)=>{e.beginPath(),e.arc(i[0],i[1],r*.5,0,Math.PI*2)},Kt=(e,i)=>Math.round(e/i)*i;var T={},Ie=Math.round,jt=Math.min,qt=Math.max,Yt=Math.ceil,Zt=Gt;function j(e,i,r,o){o[0]=Ie(e*255),o[1]=Ie(i*255),o[2]=Ie(r*255)}function it(e,i,r){return qt(i,jt(e,r))}function Gt(e,i,r,o){if(o=o||[0,0,0],e=e%360,i=it(i,0,1),r=it(r,0,1),!i)o[0]=o[1]=o[2]=Yt(r*255);else{var s=(1-i)*r,h=r-s,d=e%60;switch(e/60|0){case 0:j(r,h*e/60+s,s,o);break;case 1:j(h*(60-d)/60+s,r,s,o);break;case 2:j(s,r,h*d/60+s,o);break;case 3:j(s,h*(60-d)/60+s,r,o);break;case 4:j(h*d/60+s,s,r,o);break;case 5:j(r,s,h*(60-d)/60+s,o);break}}return o}var Ue=Math.round,Xt=function(e,i,r){var o,s,h,d=Math.max(e,i,r),m=Math.min(e,i,r),w=d-m;return w===0?o=0:e===d?o=(i-r)/w%6:i===d?o=(r-e)/w+2:r===d&&(o=(e-i)/w+4),o=Ue(o*60),o<0&&(o+=360),s=Ue((d===0?0:w/d)*100),h=Ue(d/255*100),[o,s,h]};Object.defineProperty(T,"__esModule",{value:!0});T.hex2rgb=T.rgb2hsv=T.hsb2rgb=lt=T.hsv2rgb=void 0;const te=Zt,fe=Xt;function ot(e,i,r,o){if(i!==void 0&&r!==void 0&&o!==void 0)return[...te(e*360,i,r),o];if(i!==void 0&&r!==void 0)return[...te(e*360,i,r)];if(i===void 0)if(Array.isArray(e)){const s=[...e];if(s[0]*=360,s.length===3)return[...te(...s)];if(s.length===4)return[...te(...s.slice(0,3)),s[3]]}else return[...te(0,0,e)];throw new Error("hsv2rgb(): doesn't support the type or length of arguments provided")}var lt=T.hsv2rgb=ot;T.hsb2rgb=ot;function Qt(e,i,r,o){if(i!==void 0&&r!==void 0&&o!==void 0){const s=fe(e,i,r);return[s[0]/360,s[1]/100,s[2]/100,o]}else if(i!==void 0&&r!==void 0){const s=fe(e,i,r);return[s[0]/360,s[1]/100,s[2]/100]}else if(i===void 0){if(e.length===3){const s=fe(...e);return[s[0]/360,s[1]/100,s[2]/100]}else if(e.length===4){const s=fe(...e.slice(0,3));return[s[0]/360,s[1]/100,s[2]/100,e[3]]}}throw new Error("rgb2hsv(): doesn't support the type or length of arguments provided")}T.rgb2hsv=Qt;function Jt(e){let i;if(e.length===7||e.length===9){if(i=e.substring(1,9).match(/.{2}/g),i)return i.map((r,o)=>{let s=parseInt(r,16);return o===3&&(s/=255),s})}else if((e.length===4||e.length===5)&&(i=e.substring(1,5).match(/.{1}/g),i))return i.map((r,o)=>{let s=parseInt(r+r,16);return o===3&&(s/=255),s});throw new Error("hex2rgb(): doesn't support the length or value of string argument provided")}T.hex2rgb=Jt;const Ve=Math.floor(Math.random()*10+2),ei=({context:e,width:i,height:r})=>{const o=Ve,s=10;return({width:h,height:d,playhead:m,totalFrames:w})=>{e.fillStyle="#aaa",e.fillRect(0,0,h,d);const C=Math.min(h,d),_=C*.28;e.lineWidth=C*.015;for(let u=0;u<o;u++)e.save(),e.translate(h/2,d/2),e.rotate(u/o*Math.PI*2),tt(e,[_,0],_),e.strokeStyle="#333",e.stroke(),e.restore();m=Kt(m,1/w);const a=m*Math.PI*2;e.save(),e.translate(h/2,d/2),e.rotate(a);for(let u=0;u<s;u++)tt(e,[_,0],_-_*u/s),e.fillStyle=`rgb(${lt(.5+u*.05,1-u*.08,1)})`,e.fill();e.restore()}},ti={mode:"2d",pixelRatio:window.devicePixelRatio,animate:!0,duration:1e3,playFps:Ve,exportFps:Ve};Ht(ei,ti);export{bt as _,ii as s};
